<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Personal Budget</title>
    
    <!-- SEO Meta Tags -->
    <meta name="description" content="Personal Budget is a free app to manage your finances and expenses effectively. Stay on track with alerts, charts, and insights.">
    <meta name="keywords" content="budget app, free finance app, manage expenses, personal finance tool, budget tracker">
    
    <!-- Stylesheets -->
    <link rel="stylesheet" href="reset.css">
    <link rel="stylesheet" href="main.css">
    <style>
        /* Add styling for the D3 pie chart labels */
        #d3-chart .label {
            font-size: 12px;
            fill: #000; /* Color of the text */
        }

        /* Add some basic styling for the pie chart */
        .slice text {
            font-size: 14px;
            fill: white;
            font-weight: bold;
        }

        .legend {
            font-size: 12px;
            font-family: sans-serif;
        }

        .legend rect {
            stroke-width: 2;
            stroke: black;
        }

    </style>
</head>
<body>

    <a href="#main" class="skip">Skip to content</a>

    <nav role="navigation">
        <ul>
            <li><a href="/">Home</a></li>
            <li><a href="/about.html">About</a></li>
            <li><a href="/login.html">Login</a></li>
            <li><a href="https://google.com">Google</a></li>
        </ul>
    </nav>

    <header class="hero">
        <h1>Personal Budget</h1>
        <h2>A personal-budget management app</h2>
    </header>

    <button aria-label="Learn more about budget management" onclick="location.href='/about.html'">Learn More</button>

    <main class="center" id="main">
        <section class="page-area">
            <article>
                <h3>Stay on track</h3>
                <p>
                    Do you know where you are spending your money? If you really stop to track it down,
                    you would get surprised! Proper budget management depends on real data... and this
                    app will help you with that!
                </p>
            </article>

            <article>
                <h3>Alerts</h3>
                <p>
                    What if your clothing budget ended? You will get an alert. The goal is to never go over the budget.
                </p>
            </article>

            <article>
                <h3>Results</h3>
                <p>
                    People who stick to a financial plan, budgeting every expense, get out of debt faster!
                    Also, they live happier lives... since they expend without guilt or fear... 
                    because they know it is all good and accounted for.
                </p>
            </article>

            <article>
                <h3>Chart</h3>
                <p>
                    The pie chart represents the distribution of your budget across different categories.
                </p>
                <canvas id="myChart" width="400" height="400" role="img" aria-label="Budget distribution pie chart showing various categories"></canvas>
            </article>

            <article>
                <h3>D3 Chart</h3>
                <p>
                    The pie chart below represents your budget data.
                </p>   
                <div id="d3-chart"></div>  
            </article>
        </section>
    </main>

    <footer class="bottom">
        <div class="center">
            All rights reserved &copy; Fabio Nolasco
        </div>
    </footer>

    <!-- Scripts -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/axios/0.20.0/axios.min.js" integrity="sha512-quHCp3WbBNkwLfYUMd+KwBAgpVukJu5MncuQaWXgCrfgcxCJAq/fo+oqrRKOj+UKEmyMCG3tb8RB63W+EmrOBg==" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.9.3/Chart.min.js" integrity="sha512-s+xg36jbIujB2S2VKfpGmlC3T5V2TF3lY48DX7u2r9XzGzgPsa6wTpOQA7J9iffvdeBN0q9tKzRxVxw1JviZPg==" crossorigin="anonymous"></script>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <script>
        var dataSource = {
            datasets: [
                {
                    data: [],
                    backgroundColor: [
                        '#ffcd56',
                        '#ff6384',
                        '#36a2eb',
                        '#fd6b19',
                        '#008000',
                        '#800080',
                        '#FF0000'
                    ]
                }
            ],
            labels: []
        };

        function createChart() {
            var ctx = document.getElementById('myChart').getContext('2d');
            var myPieChart = new Chart(ctx, {
                type: 'pie',
                data: dataSource
            });
        }

        function createD3PieChart(data) {
            var width = 500;
            var height = 500;
            var radius = Math.min(width, height) / 2;
            
            var svg = d3.select("#d3-chart").append("svg")
                .attr("width", width)
                .attr("height", height)
                .append("g")
                .attr("transform", "translate(" + width / 2 + "," + height / 2 + ")");

            var color = d3.scaleOrdinal()
                .range(['#ffcd56', '#ff6384', '#36a2eb', '#fd6b19', '#008000', '#800080', '#FF0000']);

            var pie = d3.pie()
                .value(function(d) { return d.budget; });

            var arc = d3.arc()
                .outerRadius(radius - 10)
                .innerRadius(0);

            var labelArc = d3.arc()
                .outerRadius(radius - 40)
                .innerRadius(radius - 40);

            var g = svg.selectAll(".arc")
                .data(pie(data))
                .enter().append("g")
                .attr("class", "arc");

            g.append("path")
                .attr("d", arc)
                .style("fill", function(d) { return color(d.data.title); });

            g.append("text")
                .attr("transform", function(d) { return "translate(" + labelArc.centroid(d) + ")"; })
                .attr("dy", ".35em")
                .text(function(d) { return d.data.title; });
        }

        function getBudget() {
            axios.get('http://localhost:3000/budget')
            .then(function (res) {
                var data = res.data.myBudget;

                dataSource.datasets[0].data = data.map(d => d.budget);
                dataSource.labels = data.map(d => d.title);
                
                createChart();
                createD3PieChart(data);
            });
        }

        getBudget();
    </script>
</body>
</html>
