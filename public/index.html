<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Personal Budget</title>
    
    <!-- SEO Meta Tags -->
    <meta name="description" content="Personal Budget is a free app to manage your finances and expenses effectively. Stay on track with alerts, charts, and insights.">
    <meta name="keywords" content="budget app, free finance app, manage expenses, personal finance tool, budget tracker">
    
    <!-- Stylesheets -->
    <link rel="stylesheet" href="reset.css">
    <link rel="stylesheet" href="main.css">
    <style>
        /* Add styling for the D3 chart labels */
        #d3-chart .label {
            font-size: 12px;
            fill: #000; /* Color of the text */
        }
    </style>
</head>
<body>

    <a href="#main" class="skip">Skip to content</a>

    <nav role="navigation">
        <ul>
            <li><a href="/">Home</a></li>
            <li><a href="/about.html">About</a></li>
            <li><a href="/login.html">Login</a></li>
            <li><a href="https://google.com">Google</a></li>
        </ul>
    </nav>

    <header class="hero">
        <h1>Personal Budget</h1>
        <h2>A personal-budget management app</h2>
    </header>

    <button aria-label="Learn more about budget management" onclick="location.href='/about.html'">Learn More</button>

    <main class="center" id="main">
        <section class="page-area">
            <article>
                <h3>Stay on track</h3>
                <p>
                    Do you know where you are spending your money? If you really stop to track it down,
                    you would get surprised! Proper budget management depends on real data... and this
                    app will help you with that!
                </p>
            </article>

            <article>
                <h3>Alerts</h3>
                <p>
                    What if your clothing budget ended? You will get an alert. The goal is to never go over the budget.
                </p>
            </article>

            <article>
                <h3>Results</h3>
                <p>
                    People who stick to a financial plan, budgeting every expense, get out of debt faster!
                    Also, they live happier lives... since they expend without guilt or fear... 
                    because they know it is all good and accounted for.
                </p>
            </article>

            <article>
                <h3>Chart</h3>
                <p>
                    The pie chart represents the distribution of your budget across different categories.
                </p>
                <canvas id="myChart" width="400" height="400" role="img" aria-label="Budget distribution pie chart showing various categories"></canvas>
            </article>

            <article>
                <h3>D3 Chart</h3>
                <p>
                    The bar chart represents your budget data.
                </p>   <br>
                <div id="d3-chart"></div>  <br>
            </article>
        </section>
    </main>

    <footer class="bottom">
        <div class="center">
            All rights reserved &copy; Fabio Nolasco
        </div>
    </footer>

    <!-- Scripts -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/axios/0.20.0/axios.min.js" integrity="sha512-quHCp3WbBNkwLfYUMd+KwBAgpVukJu5MncuQaWXgCrfgcxCJAq/fo+oqrRKOj+UKEmyMCG3tb8RB63W+EmrOBg==" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.9.3/Chart.min.js" integrity="sha512-s+xg36jbIujB2S2VKfpGmlC3T5V2TF3lY48DX7u2r9XzGzgPsa6wTpOQA7J9iffvdeBN0q9tKzRxVxw1JviZPg==" crossorigin="anonymous"></script>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <script>
        var dataSource = {
            datasets: [
                {
                    data: [],
                    backgroundColor: [
                        '#ffcd56',
                        '#ff6384',
                        '#36a2eb',
                        '#fd6b19',
                        '#008000',
                        '#800080',
                        '#FF0000'
                    ]
                }
            ],
            labels: []
        };

        function createChart() {
            var ctx = document.getElementById('myChart').getContext('2d');
            var myPieChart = new Chart(ctx, {
                type: 'pie',
                data: dataSource
            });
        }

        function createD3Chart(data) {
            console.log(data);

    var svg = d3.select("#d3-chart").append("svg")
        .attr("width", 500)
        .attr("height", 300)
        .attr("viewBox", "0 0 500 300")
        .attr("preserveAspectRatio", "xMidYMid meet");

    var x = d3.scaleBand()
        .domain(data.map(d => d.title))
        .range([0, 500])
        .padding(0.1);

    var y = d3.scaleLinear()
        .domain([0, d3.max(data, d => d.budget)])
        .nice()
        .range([300, 0]);

    // Create bars
    svg.selectAll(".bar")
        .data(data)
        .enter().append("rect")
        .attr("class", "bar")
        .attr("x", d => x(d.title))
        .attr("y", d => y(d.budget))
        .attr("width", x.bandwidth())
        .attr("height", d => 300 - y(d.budget))
        .attr("fill", "#36a2eb");

    // Add x-axis
    svg.append("g")
        .attr("class", "x-axis")
        .attr("transform", "translate(0,300)")
        .call(d3.axisBottom(x));

    // Add y-axis
    svg.append("g")
        .attr("class", "y-axis")
        .call(d3.axisLeft(y));

    // Add text labels on top of bars
    svg.selectAll(".label")
        .data(data)
        .enter().append("text")
        .attr("class", "label")
        .attr("x", d => x(d.title) + x.bandwidth() / 2)  // Center the text horizontally
        .attr("y", d => {
            // Ensure label is positioned above the bar and within the SVG container
            var labelY = y(d.budget) - 5;
            return labelY < 9 ? 9 : labelY; // Adjust label position if it goes above the container
        })
        .attr("text-anchor", "middle") // Center text horizontally
        .text(d => d.budget); // Display the budget value
}

        function getBudget() {
            axios.get('http://localhost:3000/budget')
            .then(function (res) {
                var data = res.data.myBudget;

                dataSource.datasets[0].data = data.map(d => d.budget);
                dataSource.labels = data.map(d => d.title);
                
                createChart();
                createD3Chart(data);
            });
        }

        getBudget();
    </script>
</body>
</html>
